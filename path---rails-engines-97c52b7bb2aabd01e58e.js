webpackJsonp([39199859270695],{349:function(n,s){n.exports={data:{markdownRemark:{html:'<h2>Motivation</h2>\n<p>Mounting applications within applications is a powerful technique, that allows developers to build highly scalable applications that are both cost effective and easy to maintain. <a href="http://api.rubyonrails.org/classes/Rails/Engine.html">Rails Engines</a> give developers the power to transform a rails apps into ruby gems. Many popular ruby gems such as <a href="https://github.com/plataformatec/devise">Device</a> and <a href="https://github.com/spree/spree">Spree</a> leverage rails engines to provide default custom views like login forms. Having a suite of rails engines has a ton of advantages and I would recommend refactoring large monolith apps into smaller engines.</p>\n<h2>Getting Started</h2>\n<p>As an example, i\'m going to set up a blog that is made up of two component applications a <code>blog_api</code> and <code>blog_core</code> (the core application). I\'m not going to do anything fancy, i\'m just going to set up each component as separate rails apps and write a little extra code to make them "mountable".</p>\n<h3>Blog API</h3>\n<p>Let\'s start by, first, setting up the API.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code class="language-none">rails new blog_api</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code class="language-none">cd blog_api\nrails g scaffold posts title:string context:text\ntouch blog_api.gemspec</code></pre>\n      </div>\n<p>We also setup a gemspec; this allows us export our rails app as a ruby gem.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># ~/blog_api/blog_api.gemspec</span>\n\n$<span class="token punctuation">:</span><span class="token punctuation">.</span>push <span class="token builtin">File</span><span class="token punctuation">.</span><span class="token function">expand_path</span><span class="token punctuation">(</span><span class="token string">"../lib"</span><span class="token punctuation">,</span> __FILE__<span class="token punctuation">)</span>\n\n<span class="token constant">Gem</span><span class="token punctuation">:</span><span class="token symbol">:Specification</span><span class="token punctuation">.</span><span class="token keyword">new</span> <span class="token class-name">do</span> <span class="token operator">|</span>s<span class="token operator">|</span>\n  s<span class="token punctuation">.</span>name        <span class="token operator">=</span> <span class="token string">"blog_api"</span>\n  s<span class="token punctuation">.</span>version     <span class="token operator">=</span> <span class="token string">"0.0.1"</span>\n  s<span class="token punctuation">.</span>authors     <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Paul Serraino"</span><span class="token punctuation">]</span>\n  s<span class="token punctuation">.</span>summary     <span class="token operator">=</span> <span class="token string">"testing out mounting apps"</span>\n\n  s<span class="token punctuation">.</span>files <span class="token operator">=</span> <span class="token builtin">Dir</span><span class="token punctuation">[</span><span class="token string">"{app,config,db,lib}/**/*"</span><span class="token punctuation">,</span> <span class="token string">"MIT-LICENSE"</span><span class="token punctuation">,</span> <span class="token string">"Rakefile"</span><span class="token punctuation">,</span> <span class="token string">"README.rdoc"</span><span class="token punctuation">]</span>\n  s<span class="token punctuation">.</span>test_files <span class="token operator">=</span> <span class="token builtin">Dir</span><span class="token punctuation">[</span><span class="token string">"test/**/*"</span><span class="token punctuation">]</span>\n\n  s<span class="token punctuation">.</span>add_dependency <span class="token string">"rails"</span><span class="token punctuation">,</span> <span class="token string">"~> 4.2.5.1"</span>\n\n  s<span class="token punctuation">.</span>add_development_dependency <span class="token string">"sqlite3"</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>Next, we\'re going to setup the engine itself for our blog API.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code class="language-none"># ~/blog_api\n\nmkdir -p lib/engines/blog_api\ntouch lib/engines/blog_api/engine.rb</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># ~/blog_api/lib/engines/blog_api/engine.rb</span>\n\n<span class="token keyword">module</span> <span class="token constant">BlogAPI</span>\n    <span class="token keyword">class</span> <span class="token class-name">Engine</span> <span class="token operator">&lt;</span> <span class="token constant">Rails</span><span class="token punctuation">:</span><span class="token symbol">:Engine</span>\n    <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>Next, we\'re going to add one more file</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code class="language-none"># ~/blog_api\ntouch lib/blog_api.rb</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># ~/blog_api/lib/blog_api.rb</span>\n\n<span class="token keyword">require</span> <span class="token string">\'engines/blog_api/engine\'</span>\n<span class="token keyword">module</span> <span class="token constant">BlogAPI</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>That\'s it, our blog API is now a ruby gem!</p>\n<h3>Blog Core</h3>\n<p>Now that we have our blog API gem we can include in our core application.</p>\n<p>First, we need to setup our core app.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code class="language-none"># ~/\nrails new blog_core\ncd blog_core</code></pre>\n      </div>\n<p>In our gem file we\'re going to include the <code>blog_api</code> gem that we just created, using a relative path.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># ~/blog_core/Gemfile</span>\n\ngem <span class="token string">\'blog_api\'</span><span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token string">\'../blog_api\'</span>\n</code></pre>\n      </div>\n<p>Next, we need to run the <code>blog_api</code> migrations with <code>blog_core</code>.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code class="language-none"># ~/blog_core\nrake blog_api_engine:install:migrations\nrake db:migrate</code></pre>\n      </div>\n<p>And that\'s it! We have successfully mounted our <code>blog_api</code> within <code>blog_core</code>.</p>\n<p>So this was just a boilerplate example of using rails engines (just to get started). There are many ways of making your rails engine more robust, such as mounting an engine on a specific route or autosyncing database migrations. I\'m not going to go into too much depth in optimizing a rails engine in this post , there are plenty of resources online to help you out, if you\'re interested in doing that, but I will briefly cover autosyncing database migrations since it\'s fairly easy to accomplish.</p>\n<h2>Syncing Migrations</h2>\n<p>Interestingly, Rails Engines inherent from <a href="http://api.rubyonrails.org/classes/Rails/Railtie.html">Railties</a>. Railties allow developers to hook into and extend the Rails initialization process. So we can write initializers in our <code>blog_api</code> engine and Rails will execute the initializers when the gem is required.</p>\n<p>Let\'s set up an initialization process to append the <code>blog_api</code> migrations to the migrations found in <code>blog_core</code>.</p>\n<div class="gatsby-highlight">\n      <pre class="language-ruby"><code class="language-ruby"><span class="token comment"># ~/blog_api/lib/engines/blog_api/engine.rb</span>\n\n<span class="token keyword">module</span> <span class="token constant">BlogAPI</span>\n    <span class="token keyword">class</span> <span class="token class-name">Engine</span> <span class="token operator">&lt;</span> <span class="token constant">Rails</span><span class="token punctuation">:</span><span class="token symbol">:Engine</span>\n\n        initializer <span class="token symbol">:append_migrations</span> <span class="token keyword">do</span> <span class="token operator">|</span>app<span class="token operator">|</span>\n            <span class="token keyword">unless</span> app<span class="token punctuation">.</span>root<span class="token punctuation">.</span>to_s<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>to_s<span class="token punctuation">)</span>\n                config<span class="token punctuation">.</span>paths<span class="token punctuation">[</span><span class="token string">"db/migrate"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>expanded<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>expand_path<span class="token operator">|</span>\n                    app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>paths<span class="token punctuation">[</span><span class="token string">\'db/migrate\'</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> expand_path\n                <span class="token keyword">end</span>\n            <span class="token keyword">end</span>\n        <span class="token keyword">end</span>\n\n    <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n</code></pre>\n      </div>\n<p>Now we can simply run <code>rake db:migrate</code> and <code>blog_core</code> will know to include the <code>blog_api</code> migrations.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code class="language-none"># ~/blog_core\nrake db:migrate</code></pre>\n      </div>\n<h2>Resources</h2>\n<ul>\n<li><a href="http://api.rubyonrails.org/classes/Rails/Engine.html">Rails Engine Docs</a></li>\n<li><a href="https://www.amberbit.com/blog/2015/10/15/rails-mountable-engines">rails-mountable-engines</a></li>\n</ul>',frontmatter:{date:"February 29, 2016",path:"/rails-engines",title:"Using Rails Engines Like a Pro"}}},pathContext:{}}}});
//# sourceMappingURL=path---rails-engines-97c52b7bb2aabd01e58e.js.map